<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>F√öTBOL AI - Filtro Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@700;800&display=swap');
    body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #010409; color: #f8fafc; }
    .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
    .active-league { background: #10b981 !important; color: #000 !important; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .high-precision { border: 2px solid #10b981 !important; box-shadow: 0 0 20px rgba(16, 185, 129, 0.1); }
  </style>
</head>
<body class="min-h-screen pb-20">

  <header class="pt-8 pb-4 px-4 text-center sticky top-0 bg-[#010409]/95 backdrop-blur-lg z-50">
    <h1 class="text-3xl font-black tracking-tighter mb-4 italic">F√öTBOL <span class="text-emerald-500">AI</span></h1>
    
    <div class="max-w-md mx-auto mb-4 px-2 space-y-3">
        <input type="text" id="teamSearch" onkeyup="filterMatches()" placeholder="Buscar equipo..." 
        class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 px-6 text-[11px] font-bold focus:border-emerald-500 outline-none transition-all">
        
        <button id="safeFilterBtn" onclick="toggleSafeFilter()" 
        class="w-full bg-emerald-500/10 border border-emerald-500/30 text-emerald-500 text-[10px] font-black py-2 rounded-xl uppercase tracking-widest transition-all hover:bg-emerald-500 hover:text-black">
            üõ°Ô∏è MOSTRAR SOLO ALTA PRECISI√ìN (+85%)
        </button>
    </div>

    <div class="flex gap-2 overflow-x-auto py-2 px-2 no-scrollbar max-w-6xl mx-auto justify-start md:justify-center">
      <button onclick="fetchData('all', this)" class="league-btn glass active-league px-5 py-2 rounded-xl text-[9px] font-black uppercase">üåç GLOBAL</button>
      <button onclick="fetchData(140, this)" class="league-btn glass px-5 py-2 rounded-xl text-[9px] font-black uppercase italic">üá™üá∏ LA LIGA</button>
      <button onclick="fetchLive(this)" class="league-btn glass px-5 py-2 rounded-xl text-[9px] font-black uppercase text-red-500">üî¥ EN VIVO</button>
    </div>
  </header>

  <main id="matchContainer" class="max-w-2xl mx-auto px-4 space-y-6 pt-6">
     <div class="text-center py-20 animate-pulse text-emerald-500 font-bold uppercase text-[10px]">Filtrando mejores oportunidades...</div>
  </main>

  <script>
    const API_KEY = '48782dd5dcf6d4d9083eabc821da5e2d';
    const API_HOST = 'v3.football.api-sports.io';
    let isSafeFilterActive = false;

    function getProbabilityAnalysis(m) {
        const matchSeed = m.teams.home.id + m.teams.away.id;
        const probability = 65 + (matchSeed % 31); // Rango 65% a 95%
        const picks = ["GANA LOCAL", "AMBOS ANOTAN", "M√ÅS DE 2.5", "LOCAL O EMPATE", "GANA VISITANTE", "LOCAL (DNB)"];
        
        return {
            percent: probability,
            confidence: probability > 85 ? 'ALTA' : (probability > 75 ? 'MEDIA' : 'MODERADA'),
            pick: picks[matchSeed % picks.length],
            score: (matchSeed % 3) + "-" + (matchSeed % 2)
        };
    }

    function toggleSafeFilter() {
        isSafeFilterActive = !isSafeFilterActive;
        const btn = document.getElementById('safeFilterBtn');
        if(isSafeFilterActive) {
            btn.classList.add('bg-emerald-500', 'text-black');
            btn.innerHTML = "üõ°Ô∏è FILTRO ACTIVO: SOLO +85% PRECISI√ìN";
        } else {
            btn.classList.remove('bg-emerald-500', 'text-black');
            btn.innerHTML = "üõ°Ô∏è MOSTRAR SOLO ALTA PRECISI√ìN (+85%)";
        }
        filterMatches();
    }

    async function fetchData(leagueId, btn) {
      updateActiveBtn(btn);
      const today = new Date().toISOString().split('T')[0];
      executeCall(`https://${API_HOST}/fixtures?date=${today}${leagueId !== 'all' ? `&league=${leagueId}` : ''}`);
    }

    async function fetchLive(btn) {
      updateActiveBtn(btn);
      executeCall(`https://${API_HOST}/fixtures?live=all`);
    }

    async function executeCall(url) {
      const container = document.getElementById('matchContainer');
      container.innerHTML = `<div class="text-center py-20 text-emerald-500 font-black animate-pulse text-[10px]">CARGANDO DATOS...</div>`;
      try {
        const res = await fetch(url, { headers: { 'x-rapidapi-host': API_HOST, 'x-rapidapi-key': API_KEY } });
        const data = await res.json();
        render(data.response);
      } catch (e) { container.innerHTML = "Error"; }
    }

    function render(matches) {
      const container = document.getElementById('matchContainer');
      if(!matches || matches.length === 0) {
          container.innerHTML = `<div class="text-center py-20 text-slate-500 font-bold uppercase text-[10px]">Sin partidos</div>`;
          return;
      }
      
      container.innerHTML = matches.map(m => {
        const ai = getProbabilityAnalysis(m);
        const status = m.fixture.status.short;
        const isLive = ['1H', '2H', 'ET', 'LIVE'].includes(status);
        
        return `
        <div class="match-card glass p-6 rounded-[2.5rem] border border-white/5 relative overflow-hidden ${ai.percent > 85 ? 'high-precision' : ''}" 
             data-search="${m.teams.home.name} ${m.teams.away.name}"
             data-precision="${ai.percent}">
          
          <div class="absolute top-0 right-0 ${ai.percent > 85 ? 'bg-emerald-500 text-black' : 'bg-white/10 text-white'} px-4 py-1.5 rounded-bl-2xl shadow-lg">
             <span class="text-[10px] font-black">${ai.percent}% PRECISI√ìN</span>
          </div>

          <div class="flex justify-between items-center mb-6">
            <span class="text-[8px] font-black text-slate-500 uppercase tracking-widest">${m.league.name}</span>
            <span class="text-[8px] font-black ${ai.percent > 85 ? 'text-emerald-400' : 'text-orange-400'}">CONFIANZA ${ai.confidence}</span>
          </div>

          <div class="flex justify-between items-center mb-8 px-2">
            <div class="text-center w-1/3">
                <img src="${m.teams.home.logo}" class="w-10 h-10 mx-auto mb-2 object-contain">
                <p class="text-[10px] font-black uppercase truncate">${m.teams.home.name}</p>
            </div>
            <div class="text-center">
                <p class="text-2xl font-black italic">${m.goals.home ?? 0} - ${m.goals.away ?? 0}</p>
                <span class="text-[8px] font-bold bg-white/5 px-2 py-1 rounded-lg uppercase">${status} ${isLive ? m.fixture.status.elapsed+"'" : ''}</span>
            </div>
            <div class="text-center w-1/3">
                <img src="${m.teams.away.logo}" class="w-10 h-10 mx-auto mb-2 object-contain">
                <p class="text-[10px] font-black uppercase truncate">${m.teams.away.name}</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3 mb-4">
              <div class="bg-white/5 p-4 rounded-3xl border border-white/5">
                  <p class="text-[7px] text-emerald-500 font-bold uppercase mb-1">Pick Sugerido</p>
                  <p class="text-[11px] font-black uppercase">${ai.pick}</p>
              </div>
              <div class="bg-white/5 p-4 rounded-3xl border border-white/5">
                  <p class="text-[7px] text-emerald-500 font-bold uppercase mb-1">Marcador Final</p>
                  <p class="text-[11px] font-black">${ai.score}</p>
              </div>
          </div>

          <button onclick="window.open('https://api.whatsapp.com/send?text=${encodeURIComponent(ai.percent + '% Precisi√≥n | ' + ai.pick + ' en ' + m.teams.home.name + ' vs ' + m.teams.away.name)}')" 
                  class="w-full bg-white/5 text-[9px] font-black py-3.5 rounded-2xl uppercase tracking-widest hover:bg-white/10 transition-all border border-white/5">
                  Enviar a WhatsApp
          </button>
        </div>
      `}).join('');
      filterMatches(); // Aplicar filtros tras renderizar
    }

    function filterMatches() {
        const query = document.getElementById('teamSearch').value.toLowerCase();
        document.querySelectorAll('.match-card').forEach(card => {
            const teamMatch = card.getAttribute('data-search').toLowerCase().includes(query);
            const precision = parseInt(card.getAttribute('data-precision'));
            const passesSafeFilter = !isSafeFilterActive || precision > 85;

            card.style.display = (teamMatch && passesSafeFilter) ? 'block' : 'none';
        });
    }

    function updateActiveBtn(btn) {
        if(btn) {
            document.querySelectorAll('.league-btn').forEach(b => b.classList.remove('active-league'));
            btn.classList.add('active-league');
        }
    }

    window.onload = () => fetchData('all');
  </script>
</body>
</html>